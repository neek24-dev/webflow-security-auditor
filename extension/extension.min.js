import{Webflow as y}from"@webflow/designer";var I=new y({});async function g(){return(await I.getSite()).id}async function d(a,c="GET",t=null){let s=localStorage.getItem("idToken");if(!s)throw new Error("No ID token found. Please authenticate at http://localhost:3000/auth");let n={method:c,headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}};t&&(n.body=JSON.stringify(t));let r=await fetch(`http://localhost:3000${a}`,n);if(!r.ok){let u=await r.json();throw new Error(u.error||"Request failed")}return r.json()}function p(a,c){if(c.innerHTML="",a.length===0){let t=document.createElement("li");t.className="text-gray-600 italic",t.textContent="No issues found.",c.appendChild(t);return}a.forEach(t=>{let s=document.createElement("li");s.className="p-2 bg-white rounded-md shadow-sm",typeof t=="string"?s.textContent=t:t.url?s.innerHTML=`<span class="font-medium">URL:</span> ${t.url} ${t.status?`<span class="text-red-600">(Status: ${t.status})</span>`:""} ${t.text?`<span class="text-gray-600">(${t.text})</span>`:""}`:t.type?s.innerHTML=`<span class="font-medium">Issue:</span> ${t.type} - ${t.details.join(", ")}`:t.resources&&(s.innerHTML=`<span class="font-medium">Resources:</span> ${t.resources.length} found, ${t.suspicious.length} suspicious (${t.suspicious.map(n=>`${n.type}: ${n.url}`).join(", ")})`),c.appendChild(s)})}async function L(){let a=document.getElementById("checkLinksBtn"),c=document.getElementById("securityAuditBtn"),t=document.getElementById("monitorResourcesBtn"),s=document.getElementById("back-to-designer"),n=document.getElementById("results"),r=document.getElementById("resultsList"),u=document.getElementById("error"),w=document.getElementById("loading"),o=e=>{w.classList.toggle("hidden",!e),n.classList.add("hidden"),u.classList.add("hidden")},h=e=>{u.textContent=e,u.classList.remove("hidden"),n.classList.add("hidden")};a.addEventListener("click",async()=>{try{o(!0);let e=await g(),m=await d(`/links?siteId=${e}`),f=[];for(let i of m){let l=await d("/check-link","POST",{url:i.url});l.status>=400&&f.push({...i,status:l.status})}o(!1),n.classList.remove("hidden"),p(f,r)}catch(e){o(!1),h(e.message)}}),c.addEventListener("click",async()=>{try{o(!0);let e=await g(),i=`https://${(await d(`/site-info?siteId=${e}`)).shortName}.webflow.io`,l=await d("/security-audit","POST",{url:i});o(!1),n.classList.remove("hidden"),p(l.issues,r)}catch(e){o(!1),h(e.message)}}),t.addEventListener("click",async()=>{try{o(!0);let e=await g(),i=`https://${(await d(`/site-info?siteId=${e}`)).shortName}.webflow.io`,l=await d("/monitor-resources","POST",{url:i});o(!1),n.classList.remove("hidden"),p([l],r)}catch(e){o(!1),h(e.message)}}),s.addEventListener("click",async()=>{try{let e=await g(),i=`webflow://${(await d(`/site-info?siteId=${e}`)).shortName}/designer?client_id=YOUR_CLIENT_ID`;window.location.href=i}catch(e){h("Failed to navigate back to Designer: "+e.message)}})}L();
